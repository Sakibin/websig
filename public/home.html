<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FUTURE SIGNALS</title>
  <link rel="icon" href="https://i.ibb.co/rKrQHf7f/New-Project-43-52511-DF.png" type="image/x-icon" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    :root {
      --primary: #6366f1;
      --secondary: #4f46e5;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --background: #0f172a;
      --surface: #1e293b;
      --text: #f8fafc;
      --text-secondary: #94a3b8;
      --border: #334155;
      --gold: #d4af37;
      --accent: #ffae00;
      --bg-dark: #181824;
      --bg-card: #23243a;
      --highlight: #00ff99;
      --border-dark: #44445a;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--background);
      color: var(--text);
      min-height: 100vh;
    }
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      height: 100%;
      width: 250px;
      background: var(--surface);
      border-right: 1px solid var(--border);
      padding: 2rem;
      z-index: 1001;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 3rem;
      color: var(--primary);
    }
    .nav-links {
      list-style: none;
    }
    .nav-item {
      margin-bottom: 0.5rem;
    }
    .nav-link {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      color: var(--text-secondary);
      text-decoration: none;
      border-radius: 0.5rem;
      transition: all 0.3s;
    }
    .nav-link:hover, .nav-link.active {
      background: var(--primary);
      color: var(--text);
    }
    .main-content {
      margin-left: 250px;
      padding: 2rem;
      min-height: 100vh;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
    }
    .search-bar {
      display: flex;
      align-items: center;
      gap: 1rem;
      background: var(--surface);
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      border: 1px solid var(--border);
    }
    .search-bar input {
      background: none;
      border: none;
      color: var(--text);
      outline: none;
      width: 300px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
    }
    .card {
      background: var(--surface);
      border-radius: 1rem;
      padding: 1.5rem;
      border: 1px solid var(--border);
      transition: all 0.3s;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    .card-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .card-icon {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.5rem;
      font-size: 1.25rem;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      border: none;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-primary {
      background: var(--primary);
      color: var(--text);
    }
    .btn-primary:hover {
      background: var(--secondary);
    }
    .stats {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }
    .stat {
      background: rgba(99, 102, 241, 0.1);
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-size: 0.875rem;
    }
    .profile-card {
      background: var(--surface);
      border-radius: 1rem;
      padding: 2rem;
      border: 1px solid var(--border);
      margin-bottom: 2rem;
      text-align: center;
    }
    .profile-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 4px solid var(--primary);
      margin: 0 auto 1rem;
      object-fit: cover;
    }
    .profile-name {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    .profile-role {
      color: var(--text-secondary);
      margin-bottom: 1rem;
    }
    .social-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 1rem;
    }
    .btn-social {
      background: var(--surface);
      color: var(--text);
      padding: 0.75rem 2rem;
      border-radius: 0.5rem;
      text-decoration: none;
      transition: all 0.3s;
    }
    .btn-social:hover {
      background: var(--primary);
      transform: translateY(-2px);
    }
    /* Responsive Design */
    @media (max-width: 1200px) {
      .grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 992px) {
      .sidebar {
        transform: translateX(-100%);
        z-index: 1000;
        transition: transform 0.3s ease;
      }
      .sidebar.active { transform: translateX(0); }
      .main-content { margin-left: 0; }
      .header { position: relative; }
      .menu-toggle {
        display: flex;
        flex-direction: column;
        gap: 4px;
        cursor: pointer;
        padding: 0.5rem;
        position: absolute;
        left: 1rem;
      }
      .menu-toggle span {
        width: 24px;
        height: 2px;
        background: var(--text);
        transition: 0.3s;
      }
      .menu-toggle.active span:nth-child(1) {
        transform: rotate(45deg) translate(5px, 5px);
      }
      .menu-toggle.active span:nth-child(2) {
        opacity: 0;
      }
      .menu-toggle.active span:nth-child(3) {
        transform: rotate(-45deg) translate(5px, -5px);
      }
      .search-bar { margin-left: 4rem; }
    }
    @media (max-width: 768px) {
      .grid { grid-template-columns: 1fr; }
      .header {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
      }
      .search-bar { margin-left: 0; width: 100%; }
      .search-bar input { width: 100%; }
      .btn { width: 100%; }
      .stats { flex-direction: column; }
      .stat { width: 100%; text-align: center; }
      .profile-card { padding: 1.5rem; }
      .profile-avatar { width: 100px; height: 100px; }
    }
    @media (max-width: 480px) {
      .main-content { padding: 1rem; }
      .card { padding: 1rem; }
      .card-header { flex-direction: column; text-align: center; }
      .card-icon { margin: 0 auto; }
    }
    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
    }
    .overlay.active { display: block; }
    /* Custom alert */
    .custom-alert {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--primary);
      color: var(--text);
      padding: 1rem 2rem;
      border-radius: 0.5rem;
      font-weight: bold;
      z-index: 2000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }
    .custom-alert.show {
      opacity: 1;
      pointer-events: auto;
    }
  </style>
</head>
<body>
  <!-- Sidebar Navigation -->
  <nav class="sidebar">
    <div class="logo">
      <i class="fas fa-cube"></i>
      <span>Future Signals</span>
    </div>
    <ul class="nav-links">
      <li class="nav-item">
        <a href="#" class="nav-link active">
          <i class="fas fa-home"></i>
          <span>Dashboard</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link" onclick="goToCoinSignal()">
          <i class="fas fa-coins"></i>
          <span>QUOTEX OTC</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link" onclick="goToPRIMESignals()">
          <i class="fas fa-rocket"></i>
          <span>PRO SIGNALS</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link" onclick="goToGPT()">
          <i class="fas fa-robot"></i>
          <span>GPT SIGNAL</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link" onclick="goToAdmin()">
          <i class="fas fa-user-shield"></i>
          <span>SUPPORT</span>
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link" onclick="upgradeToPremium()">
          <i class="fas fa-crown"></i>
          <span>GET PREMIUM</span>
        </a>
      </li>
    </ul>
  </nav>

  <main class="main-content" id="mainContent">
    <!-- Header -->
    <header class="header">
      <div class="menu-toggle">
        <span></span>
        <span></span>
        <span></span>
      </div>
      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Search...">
      </div>
      <button class="btn btn-primary" onclick="goToCoinSignal()">
        <i class="fas fa-plus"></i>
        <span>Get Signals</span>
      </button>
    </header>
    <div class="overlay"></div>

    <!-- Add centerNavBtns back -->
    <div id="centerNavBtns" style="display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 2rem;">
      <button id="coinSignalBtn" class="btn btn-primary">
        <i class="fas fa-coins"></i> QUOTEX OTC
      </button>
      <button id="primeSignalsBtn" class="btn btn-primary">
        <i class="fas fa-rocket"></i> PRO SIGNALS
      </button>
      <button id="gptBtn" class="btn btn-primary">
        <i class="fas fa-robot"></i> GPT SIGNAL
      </button>
      <button id="binolaBtn" class="btn btn-primary">
        <i class="fas fa-dice"></i> BINOLA
      </button>
      <button id="signalTestBtn" class="btn btn-primary">
        <i class="fas fa-vial"></i> SIGNAL TEST
      </button>
      <button id="getPremiumBtn" class="btn btn-primary">
        <i class="fas fa-crown"></i> GET PREMIUM
      </button>
      <button id="adminBtn" class="btn btn-primary">
        <i class="fas fa-user-shield"></i> SUPPORT
      </button>
    </div>

    <!-- Profile Card -->
    <div class="profile-card">
      <img src="https://ui-avatars.com/api/?name=User&background=6366f1&color=fff"
           alt="User"
           class="profile-avatar">
      <h2 class="profile-name" id="userEmail">User</h2>
      <p class="profile-role" id="userStatus">Status</p>
      <div class="social-buttons">
        <a href="https://github.com/yourusername" class="btn-social">
          <i class="fab fa-github"></i> GitHub
        </a>
        <a href="https://t.me/x_prime01" class="btn-social">
          <i class="fab fa-telegram"></i> Telegram
        </a>
      </div>
      <div style="margin-top:1rem;">
        <span id="coinCount" class="stat" style="background:rgba(212,175,55,0.1);color:var(--gold);font-weight:bold;">0 Coins</span>
      </div>
      <div id="emailVerificationStatus" style="color:#ff4444; font-size:12px; margin-top:5px; display:none;">
        <i class="fas fa-exclamation-triangle" style="margin-right:5px;"></i>Email not verified
      </div>
      <button id="verifyEmailBtn" onclick="sendEmailVerification()" class="btn btn-primary" style="margin-top:10px;display:none;">
        <i class="fas fa-envelope-check"></i> Verify Email
      </button>
      <button id="upgradeBtn" onclick="upgradeToPremium()" class="btn btn-primary" style="margin-top:10px;display:none;">
        <i class="fas fa-crown"></i> Get Premium
      </button>
      <button onclick="logout()" class="btn" style="background:var(--danger);color:white;margin-top:10px;">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
    </div>

    <!-- Dashboard Cards -->
    <div class="grid">
      <!-- Signal Maker Card -->
      <div class="card" id="signalMakerSection" style="display:none;">
        <div class="card-header">
          <div class="card-icon" style="background:rgba(99,102,241,0.1);color:var(--primary);">
            <i class="fas fa-coins"></i>
          </div>
          <h3>Signal Maker</h3>
        </div>
        <form id="signalForm">
          <label for="start"><i class="fas fa-clock"></i> START TIME</label>
          <input type="time" id="start" required style="width:100%;margin-bottom:0.5rem;" />
          <label for="end"><i class="fas fa-clock"></i> END TIME</label>
          <input type="time" id="end" required style="width:100%;margin-bottom:0.5rem;" />
          <label for="duration"><i class="fas fa-hourglass-half"></i> Duration (Days)</label>
          <input type="number" id="duration" value="5" required style="width:100%;margin-bottom:0.5rem;" />
          <label for="strategy"><i class="fas fa-cogs"></i> Strategy:</label>
          <select id="strategy" style="width:100%;margin-bottom:0.5rem;">
            <option value="normal">Normal</option>
            <option value="martingale">Martingale</option>
            <option value="trend">Trend Following</option>
          </select>
          <input type="hidden" id="currency_pairs" value="" />
          <div class="section" style="margin-top:1rem;">
            <div class="section-title" style="margin-bottom:0.5rem;">
              OTC MARKET (QUOTEX)
              <button class="btn btn-primary" type="button" style="float:right;padding:0.3rem 1rem;font-size:0.9em;" onclick="toggleSelect('otc', this)">SELECT ALL</button>
            </div>
            <div class="grid" id="otc" style="grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:0.5rem;"></div>
          </div>
          <button type="submit" class="btn btn-primary" style="margin-top:1rem;width:100%;">âž» Get Signals</button>
        </form>
        <div id="loader" style="display:none;margin:1rem auto;text-align:center;"><span>Loading...</span></div>
        <div id="results" style="margin-top:1rem;">
          <button onclick="copySignals()" id="copyBtn" class="btn btn-primary" style="display:none;margin-bottom:1rem;">Copy Signals</button>
          <table id="signalsTable" style="display:none;width:100%;background:var(--surface);color:var(--text);border-radius:0.5rem;">
            <thead>
              <tr>
                <th>Currency Pair</th>
                <th>Entry Time</th>
                <th>Direction</th>
              </tr>
            </thead>
            <tbody id="signalsBody"></tbody>
          </table>
        </div>
      </div>
      <!-- Other dashboard cards (static info or navigation) -->
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background:rgba(16,185,129,0.1);color:var(--success);">
            <i class="fas fa-rocket"></i>
          </div>
          <h3>PRO SIGNALS</h3>
        </div>
        <p>Access premium signals for advanced trading.</p>
        <div class="stats">
          <span class="stat"><i class="fas fa-crown"></i> Premium Only</span>
        </div>
        <button class="btn btn-primary" style="margin-top:1rem;" onclick="goToPRIMESignals()">Go</button>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background:rgba(245,158,11,0.1);color:var(--warning);">
            <i class="fas fa-robot"></i>
          </div>
          <h3>GPT SIGNAL</h3>
        </div>
        <p>AI-powered signal generation for smarter trades.</p>
        <div class="stats">
          <span class="stat"><i class="fas fa-bolt"></i> Premium Only</span>
        </div>
        <button class="btn btn-primary" style="margin-top:1rem;" onclick="goToGPT()">Go</button>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background:rgba(239,68,68,0.1);color:var(--danger);">
            <i class="fas fa-user-shield"></i>
          </div>
          <h3>SUPPORT</h3>
        </div>
        <p>Contact admin or get help via Telegram.</p>
        <div class="stats">
          <span class="stat"><i class="fas fa-headset"></i> 24/7 Support</span>
        </div>
        <button class="btn btn-primary" style="margin-top:1rem;" onclick="goToAdmin()">Contact</button>
      </div>
      <!-- Market/Signal Type Cards -->
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background:rgba(99,102,241,0.1);color:var(--primary);">
            <i class="fas fa-globe"></i>
          </div>
          <h3>Forex Market</h3>
        </div>
        <p>Major currency pairs with high liquidity and tight spreads.</p>
        <div class="stats">
          <span class="stat"><i class="fas fa-coins"></i> 20+ Pairs</span>
          <span class="stat"><i class="fas fa-clock"></i> 24/5</span>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background:rgba(245,158,11,0.1);color:var(--warning);">
            <i class="fab fa-btc"></i>
          </div>
          <h3>Crypto Market</h3>
        </div>
        <p>Trade top cryptocurrencies with real-time signals.</p>
        <div class="stats">
          <span class="stat"><i class="fas fa-coins"></i> 10+ Coins</span>
          <span class="stat"><i class="fas fa-clock"></i> 24/7</span>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background:rgba(16,185,129,0.1);color:var(--success);">
            <i class="fas fa-store"></i>
          </div>
          <h3>OTC Market</h3>
        </div>
        <p>Weekend trading with exclusive OTC pairs and signals.</p>
        <div class="stats">
          <span class="stat"><i class="fas fa-coins"></i> 15+ OTC Pairs</span>
          <span class="stat"><i class="fas fa-calendar-week"></i> Sat-Sun</span>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-icon" style="background:rgba(239,68,68,0.1);color:var(--danger);">
            <i class="fas fa-signal"></i>
          </div>
          <h3>Signal Types</h3>
        </div>
        <p>Normal, Martingale, and Trend Following strategies available.</p>
        <div class="stats">
          <span class="stat"><i class="fas fa-cogs"></i> 3 Types</span>
          <span class="stat"><i class="fas fa-percentage"></i> 90%+ Accuracy</span>
        </div>
      </div>
    </div>
    <footer style="margin-top:2rem;text-align:center;color:var(--text-secondary);">
      <h4>Â© Powered by SECRET SOLUTION YT</h4>
    </footer>
    <div id="customAlert" class="custom-alert"></div>
  </main>

  <!-- Login Form Modal -->
  <div id="loginForm" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--surface); padding: 2rem 2.5rem; border-radius: 1rem; border: 1px solid var(--primary); z-index: 2001; min-width:320px;">
    <h2 style="color: var(--primary); text-align: center; margin-bottom: 1rem;">Login to Access Signals</h2>
    <input type="email" id="email" placeholder="Email" style="width: 100%; margin-bottom: 1rem; padding: 0.8rem; border: 1px solid var(--primary); background: var(--background); color: var(--primary); border-radius: 4px;">
    <input type="password" id="password" placeholder="Password" style="width: 100%; margin-bottom: 1rem; padding: 0.8rem; border: 1px solid var(--primary); background: var(--background); color: var(--primary); border-radius: 4px;">
    <button onclick="login()" class="btn btn-primary" style="width: 100%; margin-bottom: 0.5rem;">Login</button>
    <button onclick="register()" class="btn" style="width: 100%; background: transparent; color: var(--primary); border: 1px solid var(--primary); margin-bottom: 0.5rem;">Register (Get 20 Free Coins)</button>
    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
      <button onclick="showPasswordReset()" class="btn" style="width: 100%; background: transparent; color: var(--accent); border: 1px solid var(--accent); font-size: 0.9rem;">
        <i class="fas fa-key" style="margin-right: 5px;"></i>Forgot Password?
      </button>
      <div id="passwordResetSection" style="display: none; margin-top: 1rem;">
        <input type="email" id="resetEmail" placeholder="Enter your email for password reset" style="width: 100%; margin-bottom: 0.5rem; padding: 0.8rem; border: 1px solid var(--accent); background: var(--background); color: var(--primary); border-radius: 4px;">
        <button onclick="sendPasswordReset()" class="btn btn-primary" style="width: 100%;">Send Reset Link</button>
      </div>
    </div>
    <div id="authMessage" style="margin-top: 1rem; text-align: center; color: #ff4444;"></div>
  </div>

  <!-- Notification Bell Icon -->
  <div id="notifBell" style="display:none; position:fixed; top:30px; right:180px; z-index:1100; cursor:pointer;">
    <i class="fas fa-bell" style="font-size: 25px; color: var(--gold);"></i>
    <span id="notifDot" style="display:none; position:absolute; top:2px; right:2px; width:10px; height:10px; background:#ff4444; border-radius:50%;"></span>
  </div>

  <!-- Notification Popup -->
  <div id="notifPopup" style="display:none; position:fixed; top:70px; right:30px; background:rgba(30,30,40,0.97); color:#ffae00; border:2px solid #d4af37; border-radius:14px; padding:22px 32px 18px 32px; font-size:1.12em; font-weight:bold; z-index:1200; box-shadow:0 4px 24px #0008; min-width:260px; max-width:350px; animation: notifPopIn 0.5s;">
    <div style="display:flex;align-items:center;gap:10px;">
      <i class="fas fa-bell"></i>
      <span id="notifMsg">System notification</span>
    </div>
    <button onclick="closeNotifPopup()" style="margin-top:18px; background:var(--gold); color:var(--bg-dark); border:none; border-radius:8px; padding:6px 18px; font-weight:bold; cursor:pointer; float:right;">Close</button>
  </div>

  <style>
    @keyframes notifPopIn {
      0% { transform: translateY(-30px) scale(0.9); opacity: 0; }
      80% { transform: translateY(5px) scale(1.04); opacity: 1; }
      100% { transform: translateY(0) scale(1); opacity: 1; }
    }
  </style>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyC9oOgsN0IE5vw48dnp1n4SykPSQsL8lSw",
      authDomain: "sakibin-75f62.firebaseapp.com",
      projectId: "sakibin-75f62",
      storageBucket: "sakibin-75f62.appspot.com",
      messagingSenderId: "732867500543",
      appId: "1:732867500543:web:96df65624c7897c106efca",
      measurementId: "G-BGGNPS1N1X"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    let currentUser = null;
    let userToken = null;

    function toggleUserMenu() {
      const menu = document.getElementById('userMenu');
      menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
    }

    // Close menu when clicking outside
    document.addEventListener('click', function(event) {
      const avatar = document.getElementById('userAvatar');
      const menu = document.getElementById('userMenu');
      if (!avatar.contains(event.target)) {
        menu.style.display = 'none';
      }
    });

    // Authentication functions
    async function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      try {
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        showAuthMessage('Login successful!', 'success');
      } catch (error) {
        showAuthMessage(error.message, 'error');
      }
    }

    async function register() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        showAuthMessage('Registration successful! You got 20 free coins!', 'success');
        
        // Automatically send verification email after registration
        setTimeout(async () => {
          try {
            await sendEmailVerification();
          } catch (error) {
            console.error('Error sending verification email:', error);
          }
        }, 1000);
      } catch (error) {
        showAuthMessage(error.message, 'error');
      }
    }

    // Password reset functions
    function showPasswordReset() {
      const resetSection = document.getElementById('passwordResetSection');
      resetSection.style.display = resetSection.style.display === 'none' ? 'block' : 'none';
    }

    async function sendPasswordReset() {
      const email = document.getElementById('resetEmail').value;
      
      if (!email) {
        showAuthMessage('Please enter your email address', 'error');
        return;
      }

      try {
        const response = await fetch('/api/auth/reset-password', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email })
        });

        const data = await response.json();
        
        if (response.ok) {
          showAuthMessage('Password reset link sent to your email!', 'success');
          document.getElementById('passwordResetSection').style.display = 'none';
          document.getElementById('resetEmail').value = '';
        } else {
          showAuthMessage(data.error || 'Error sending reset link', 'error');
        }
      } catch (error) {
        showAuthMessage('Error sending reset link', 'error');
      }
    }

    // Email verification functions
    async function sendEmailVerification() {
      if (!userToken) {
        showAuthMessage('Please login first', 'error');
        return;
      }

      try {
        const response = await fetch('/api/auth/send-verification', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${userToken}`,
            'Content-Type': 'application/json'
          }
        });

        const data = await response.json();
        
        if (response.ok) {
          showAlert('Email verification link sent! Please check your email.');
        } else {
          showAlert(data.error || 'Error sending verification email');
        }
      } catch (error) {
        showAlert('Error sending verification email');
      }
    }

    function logout() {
      auth.signOut();
    }

    function showAuthMessage(message, type) {
      const messageEl = document.getElementById('authMessage');
      messageEl.textContent = message;
      messageEl.style.color = type === 'success' ? '#00ff99' : '#ff4444';
    }

    function upgradeToPremium() {
      // Replace 'yourtelegramusername' with your actual Telegram username
      const telegramUrl = 'https://t.me/x_prime01';
      window.open(telegramUrl, '_blank');
      showAlert('Redirecting to Telegram for Premium upgrade...');
    }

    // Navigation functions
    function goToCoinSignal() {
      // Show signal maker section, hide nav buttons
      document.getElementById('signalMakerSection').style.display = 'block';
      document.getElementById('centerNavBtns').style.display = 'none';
    }
    function goToPRIMESignals() {
      window.location.href = '/signalv2.html';
    }
    function goToGPT() {
      window.location.href = '/gpt.html';
    }
    function goToAdmin() {
      // Check if user is admin, then redirect accordingly
      fetch('/api/profile', {
        headers: {
          'Authorization': `Bearer ${userToken}`
        }
      })
      .then(res => res.json())
      .then(userData => {
        if (userData.admin === true) {
          window.location.href = '/admin?pass=14133504';
        } else {
          window.location.href = '/chat.html';
        }
      })
      .catch(() => {
        window.location.href = '/chat.html';
      });
    }

    // Attach navigation handlers after DOM loaded
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('coinSignalBtn').onclick = goToCoinSignal;
      document.getElementById('primeSignalsBtn').onclick = goToPRIMESignals;
      document.getElementById('gptBtn').onclick = goToGPT;
      document.getElementById('getPremiumBtn').onclick = upgradeToPremium;
      document.getElementById('adminBtn').onclick = goToAdmin;
      document.getElementById('binolaBtn').onclick = function() {
        window.location.href = '/binola.html';
      };
      document.getElementById('signalTestBtn').onclick = function() {
        window.location.href = '/signaltest.html';
      };
    });

    async function updateUserInfo() {
      if (!userToken) return;
      try {
        const response = await fetch('/api/profile', {
          headers: {
            'Authorization': `Bearer ${userToken}`
          }
        });
        if (response.ok) {
          const userData = await response.json();
          document.getElementById('userEmail').textContent = currentUser.email;
          document.getElementById('userStatus').textContent = userData.isPremium ? 'PREMIUM USER' : 'FREE USER';
          document.getElementById('coinCount').textContent = `${userData.coins} Coins`;
          document.getElementById('upgradeBtn').style.display = userData.isPremium ? 'none' : 'inline-block';

          // Handle email verification status
          const emailVerificationStatus = document.getElementById('emailVerificationStatus');
          const verifyEmailBtn = document.getElementById('verifyEmailBtn');
          
          if (userData.emailVerified) {
            emailVerificationStatus.style.display = 'none';
            verifyEmailBtn.style.display = 'none';
          } else {
            emailVerificationStatus.style.display = 'block';
            verifyEmailBtn.style.display = 'inline-block';
          }

          // Show/hide center navigation buttons
          document.getElementById('coinSignalBtn').style.display = 'block';
          document.getElementById('adminBtn').style.display = 'block';
          document.getElementById('binolaBtn').style.display = 'block'; // Always show BINOLA
          document.getElementById('signalTestBtn').style.display = 'block'; // Always show SIGNAL TEST
          if (userData.isPremium) {
            document.getElementById('primeSignalsBtn').style.display = 'block';
            document.getElementById('gptBtn').style.display = 'block';
            document.getElementById('getPremiumBtn').style.display = 'none';
          } else {
            document.getElementById('primeSignalsBtn').style.display = 'none';
            document.getElementById('gptBtn').style.display = 'none';
            document.getElementById('getPremiumBtn').style.display = 'block';
          }
        }
      } catch (error) {
        console.error('Error fetching user data:', error);
      }
    }

    // --- Notification System ---
    let lastNotifId = null;
    let currentNotif = null;

    function fetchAndShowNotification(autoShow = false) {
      fetch('/api/notification')
        .then(res => res.json())
        .then(data => {
          if (data && data.message) {
            lastNotifId = data.id || 1;
            currentNotif = data;
            document.getElementById('notifMsg').textContent = data.message;
            document.getElementById('notifBell').style.display = 'block';
            // Only show dot if popup is not open
            if (document.getElementById('notifPopup').style.display !== 'block') {
              document.getElementById('notifDot').style.display = 'block';
            }
            if (autoShow) showNotifPopup();
          } else {
            lastNotifId = null;
            currentNotif = null;
            document.getElementById('notifBell').style.display = 'none';
            closeNotifPopup();
          }
        });
    }

    function showNotifPopup() {
      if (!currentNotif) return;
      document.getElementById('notifPopup').style.display = 'block';
      document.getElementById('notifDot').style.display = 'none';
    }

    function closeNotifPopup() {
      document.getElementById('notifPopup').style.display = 'none';
      // If there is still a notification, show the dot again
      if (currentNotif) {
        document.getElementById('notifDot').style.display = 'block';
      } else {
        document.getElementById('notifDot').style.display = 'none';
      }
    }

    document.getElementById('notifBell').onclick = function() {
      if (currentNotif) showNotifPopup();
    };

    // Optionally, poll for new notifications every 60 seconds
    setInterval(() => {
      fetchAndShowNotification(false);
    }, 60000);

    // --- After login, show notification if exists ---
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        currentUser = user;
        userToken = await user.getIdToken();

        // Send token to server for verification
        try {
          const response = await fetch('/verifyToken', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ token: userToken })
          });

          if (response.ok) {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block'; // Show main content
            await updateUserInfo();
            fetchAndShowNotification(true);
          }
        } catch (error) {
          console.error('Error verifying token:', error);
        }
      } else {
        currentUser = null;
        userToken = null;
        document.getElementById('loginForm').style.display = 'block';
        document.getElementById('mainContent').style.display = 'none';
        
        // Update button visibility
        document.getElementById('coinSignalBtn').style.display = 'none';
        document.getElementById('primeSignalsBtn').style.display = 'none';
        document.getElementById('gptBtn').style.display = 'none';
        document.getElementById('getPremiumBtn').style.display = 'none';
        document.getElementById('adminBtn').style.display = 'none';
        document.getElementById('binolaBtn').style.display = 'block';
        document.getElementById('signalTestBtn').style.display = 'block';
      }
    });

    const pro_mode = false; // Toggle this to true or false

    function toggleSelect(section, btn) {
      const checkboxes = document.querySelectorAll(`#${section} input[type='checkbox']`);
      const allChecked = Array.from(checkboxes).every(cb => cb.checked);
      checkboxes.forEach(cb => {
        if (pro_mode || !allChecked && countSelected() < 3) {
          cb.checked = !allChecked;
          cb.closest('.pair').classList.toggle('selected', cb.checked);
        }
      });
      btn.textContent = allChecked ? 'SELECT ALL' : 'CLEAR';
    }

    function countSelected() {
      return document.querySelectorAll("input[type='checkbox']:checked").length;
    }

    function copySignals() {
      let header = `â³ Time frame 1 minutes\nðŸ›‘ 1 step martingale if need\n\n`;
      let signalLines = "";
      document.querySelectorAll("#signalsBody tr").forEach(row => {
        const cells = row.querySelectorAll("td");
        const pair = cells[0].innerText.trim();
        const time = cells[1].innerText.trim();
        const direction = cells[2].innerText.trim().toUpperCase();
        signalLines += `âš¡${pair}\t${time}\t${direction}\n`;
      });
      const finalText = header + signalLines;
      navigator.clipboard.writeText(finalText).then(() => showAlert("Signals copied!"));
    }

    function getSelectedPairs() {
      const checkboxes = document.querySelectorAll("input[type='checkbox']:checked");
      return Array.from(checkboxes).map(cb => {
        const label = cb.nextElementSibling?.textContent.trim() || '';
        return label.replace(/\//g, '').replace(/-OTC/i, '_otc');
      }).join(',');
    }

    function showAlert(message, duration = 3000) {
      const alertBox = document.getElementById("customAlert");
      alertBox.textContent = message;
      alertBox.classList.add("show");
      setTimeout(() => alertBox.classList.remove("show"), duration);
    }

    document.addEventListener('DOMContentLoaded', () => {

      const otcPairs = [
        "EUR/USD-OTC", "GBP/USD-OTC", "USD/JPY-OTC", "USD/CAD-OTC",
        "AUD/USD-OTC", "USD/CHF-OTC", "EUR/JPY-OTC", "EUR/GBP-OTC",
        "GBP/JPY-OTC", "USD/BDT-OTC", "USDDZD-OTC", "USDTRY-OTC",
        "USDCOP-OTC", "USDMXN-OTC", "USDBDT-OTC", "USDZAR-OTC",
        "USDNGN-OTC", "USDPKR-OTC", "USDIDR-OTC", "NZDCAD-OTC",
        "NZDCHF-OTC", "MCD-OTC", "MSFT-OTC"
      ];


      const otcContainer = document.getElementById('otc');

      otcPairs.forEach(pair => {
        const id = `otc-${pair.replace(/\W/g, '')}`;
        const div = document.createElement('div');
        div.className = 'pair';
        div.innerHTML = `
          <input type='checkbox' id='${id}' onchange='handleLimit(this)' />
          <label for='${id}'><i class="fas fa-chart-line"></i> ${pair}</label>`;
        otcContainer.appendChild(div);
      });
    });

    function handleLimit(checkbox) {
      const checked = checkbox.checked;
      const parent = checkbox.closest('.pair');

      if (!pro_mode && checked && countSelected() > 3) {
        checkbox.checked = false;
        showAlert("Free mode allows only 3 pairs.");
        return;
      }

      parent.classList.toggle("selected", checkbox.checked);
    }

    document.getElementById("signalForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const loader = document.getElementById("loader");
      loader.style.display = "block";

      setTimeout(() => {
        loader.style.display = "none";

        const start = document.getElementById("start").value;
        const end = document.getElementById("end").value;
        const duration = document.getElementById("duration").value;
        const currency_pairs = getSelectedPairs();

        if (!currency_pairs) {
          showAlert("Please select at least one currency pair.");
          return;
        }

        axios.get(`/api/signal?start=${encodeURIComponent(start)}&end=${encodeURIComponent(end)}&duration=${duration}&currency_pairs=${currency_pairs}&percentage_min=90`, {
          headers: {
            'Authorization': `Bearer ${userToken}`
          }
        })
          .then(response => {
            const data = response.data;
            const signals = data.signals;
            const tbody = document.getElementById("signalsBody");
            tbody.innerHTML = "";

            if (signals.length > 0) {
              signals.forEach(signal => {
                const tr = document.createElement("tr");
                tr.innerHTML = `<td>${signal.asset}-OTC</td><td>${signal.entry_time}</td><td class='${signal.main_direction}'>${signal.main_direction.toUpperCase()}</td>`;
                tbody.appendChild(tr);
              });
              document.getElementById("signalsTable").style.display = "table";
              document.getElementById("copyBtn").style.display = "block";

              // Update coin count
              document.getElementById('coinCount').textContent = `${data.userCoins} Coins`;
              if (data.userCoins <= 0) {
                showAlert("You've used all your coins! Upgrade to Premium or ask admin for more coins.");
              }
            } else {
              showAlert("No signals found.");
            }
          })
          .catch(error => {
            if (error.response?.status === 403) {
              showAlert("Insufficient coins! Upgrade to Premium for unlimited signals.");
            } else if (error.response?.status === 401) {
              showAlert("Please login to access signals.");
            } else {
              showAlert("Error fetching signals.");
            }
          });

      }, 3000);
    });

    // Sidebar and overlay toggle for mobile
    const menuToggle = document.querySelector('.menu-toggle');
    const sidebar = document.querySelector('.sidebar');
    const overlay = document.querySelector('.overlay');
    menuToggle.addEventListener('click', () => {
      menuToggle.classList.toggle('active');
      sidebar.classList.toggle('active');
      overlay.classList.toggle('active');
    });
    overlay.addEventListener('click', () => {
      menuToggle.classList.remove('active');
      sidebar.classList.remove('active');
      overlay.classList.remove('active');
    });
    window.addEventListener('resize', () => {
      if (window.innerWidth > 992) {
        menuToggle.classList.remove('active');
        sidebar.classList.remove('active');
        overlay.classList.remove('active');
      }
    });
    // Search bar filters cards
    document.querySelector('.search-bar input').addEventListener('input', (e) => {
      const search = e.target.value.toLowerCase();
      document.querySelectorAll('.card').forEach(card => {
        const text = card.textContent.toLowerCase();
        card.style.display = text.includes(search) ? 'block' : 'none';
      });
    });
  </script>
</body>
</html>